# Planning with Files Enhanced - æ•´åˆæ–¹æ¡ˆ

**ç‰ˆæœ¬**ï¼šv2.0
**ç›®æ ‡**ï¼šå°† Beads å’Œ Codemap åŠŸèƒ½æ•´åˆåˆ° Planning with Files æ¨¡å¼ä¸­
**æ ¸å¿ƒåŸåˆ™**ï¼šäººç±»å‹å¥½ä¼˜å…ˆï¼ŒAI å‹å¥½æ¬¡ä¹‹

---

## ä¸€ã€è®¾è®¡ç†å¿µ

### 1.1 æ ¸å¿ƒæ˜ å°„å…³ç³»

| Planning with Files | Beads | æ•´åˆå |
|---------------------|-------|--------|
| task_plan.md | Plan Issue | `plan.md` |
| findings.md | Finding Issue | `findings.md` |
| progress.md | Progress Issue | `progress.md` |
| - | Bug/Feature/Task Issue | `issues.md`ï¼ˆæ–°å¢ï¼‰ |
| - | Codemap Entry | `codemap.md`ï¼ˆæ–°å¢ï¼‰ |
| - | æ ¸å¿ƒä»£ç é€»è¾‘ | `knowledge.md`ï¼ˆæ–°å¢ï¼‰ |
| - | æŠ€æœ¯å†³ç­–è®°å½• | `decisions.md`ï¼ˆæ–°å¢ï¼‰ |

### 1.2 æ–‡ä»¶ç»“æ„

```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ .planning/                    # Planning å…ƒæ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ config.yaml              # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ index.jsonl              # å¯é€‰ï¼šAI ç´¢å¼•
â”‚   â””â”€â”€ hooks/                   # å¯é€‰ï¼šHooks è„šæœ¬
â”‚
â”œâ”€â”€ plan.md                      # ä¸»è§„åˆ’æ–‡ä»¶
â”œâ”€â”€ findings.md                  # ç ”ç©¶å‘ç°
â”œâ”€â”€ progress.md                  # è¿›åº¦æ—¥å¿—
â”œâ”€â”€ issues.md                    # ä»»åŠ¡/é—®é¢˜åˆ—è¡¨ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ codemap.md                   # ä»£ç åœ°å›¾ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ knowledge.md                 # æ ¸å¿ƒä»£ç é€»è¾‘ï¼ˆæ–°å¢ï¼‰
â””â”€â”€ decisions.md                 # æŠ€æœ¯å†³ç­–è®°å½•ï¼ˆæ–°å¢ï¼‰
```

### 1.3 æ–°å¢æ–‡ä»¶çš„ç†ç”±

#### ä¸ºä»€ä¹ˆéœ€è¦ `knowledge.md`ï¼Ÿ

| ç°æœ‰æ–‡ä»¶ | ä¸ºä»€ä¹ˆä¸é€‚åˆ |
|---------|-------------|
| `findings.md` | å­˜æ”¾**è°ƒç ”é˜¶æ®µ**çš„ç ”ç©¶å‘ç°ï¼Œè€Œéä»£ç å®ç°åçš„é€»è¾‘æ€»ç»“ |
| `progress.md` | å­˜æ”¾**æ—¶é—´çº¿**çš„è¿›åº¦æ—¥å¿—ï¼Œè€ŒéçŸ¥è¯†æ²‰æ·€ |
| `codemap.md` | å­˜æ”¾**å…¥å£ç´¢å¼•**ï¼Œè€Œéé€»è¾‘ç»†èŠ‚ |
| `issues.md` | å­˜æ”¾**å¾…åŠäº‹é¡¹**ï¼Œè€Œéå·²å®Œæˆçš„ä»£ç çŸ¥è¯† |

**`knowledge.md` çš„ç‹¬ç‰¹ä»·å€¼**ï¼š
- ğŸ“ è®°å½•æ ¸å¿ƒä»£ç çš„**é€»è¾‘æ€»ç»“**ï¼ˆè€Œéä»£ç ç‰‡æ®µï¼‰
- ğŸ”„ è·Ÿè¸ªä»£ç çš„**ç‰ˆæœ¬è¿­ä»£å†å²**
- ğŸ§  æ²‰æ·€**å¯å¤ç”¨çš„çŸ¥è¯†**
- ğŸ“– ä¾› AI Agent å¿«é€Ÿç†è§£**æ ¸å¿ƒé€»è¾‘**

#### ä¸ºä»€ä¹ˆéœ€è¦ `decisions.md`ï¼Ÿ

| ç°æœ‰æ–‡ä»¶ | ä¸ºä»€ä¹ˆä¸é€‚åˆ |
|---------|-------------|
| `findings.md` | å­˜æ”¾**è°ƒç ”ç»“æœ**ï¼Œä¸ä¸€å®šæœ‰å†³ç­– |
| `plan.md` | å­˜æ”¾**ä»»åŠ¡è§„åˆ’**ï¼Œè€ŒéæŠ€æœ¯å†³ç­– |

**`decisions.md` çš„ç‹¬ç‰¹ä»·å€¼**ï¼š
- ğŸ“‹ é‡‡ç”¨ **ADRï¼ˆArchitecture Decision Recordï¼‰** æ ¼å¼
- ğŸ¯ è®°å½•**æŠ€æœ¯é€‰å‹çš„èƒŒæ™¯ã€ç†ç”±ã€åæœ**
- ğŸ” ä¾›åç»­å¼€å‘è€…ç†è§£**ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡**
- ğŸ“š å½¢æˆ**æŠ€æœ¯å†³ç­–çŸ¥è¯†åº“**

---

## äºŒã€æ–‡ä»¶æ ¼å¼è®¾è®¡

### 2.1 plan.mdï¼ˆä¸»è§„åˆ’æ–‡ä»¶ï¼‰

```markdown
# Plan: å®ç°ç”¨æˆ·è®¤è¯ç³»ç»Ÿ

## å…ƒæ•°æ®
- **ID**: plan-abc123
- **çŠ¶æ€**: è¿›è¡Œä¸­
- **é˜¶æ®µ**: implementation
- **ä¼˜å…ˆçº§**: P0
- **åˆ›å»ºæ—¶é—´**: 2024-01-15
- **è´Ÿè´£äºº**: @developer

## ç›®æ ‡
å®ç°å®Œæ•´çš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼Œæ”¯æŒ OAuth2.0 å’Œ JWTã€‚

## é˜¶æ®µ

### âœ… Phase 1: Researchï¼ˆå·²å®Œæˆï¼‰
- [x] è°ƒç ” OAuth2.0 æµç¨‹
- [x] ç¡®å®š JWT å®ç°æ–¹æ¡ˆ

### ğŸ”„ Phase 2: Designï¼ˆè¿›è¡Œä¸­ï¼‰
- [x] è®¾è®¡æ•°æ®åº“ schema
- [ ] è®¾è®¡ API æ¥å£

### â³ Phase 3: Implementation
- [ ] å®ç°ç™»å½•æ¥å£
- [ ] å®ç°æ³¨å†Œæ¥å£
- [ ] å®ç°å¯†ç åŠ å¯†

### â³ Phase 4: Testing
- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•

## æ£€æŸ¥ç‚¹
- `cp-1`: å®ŒæˆåŸºç¡€æ¶æ„ï¼ˆ2024-01-16ï¼‰
- `cp-2`: å®Œæˆæ ¸å¿ƒåŠŸèƒ½ï¼ˆå¾…å®šï¼‰

## é”™è¯¯æ—¥å¿—
| æ—¶é—´ | é”™è¯¯ | çŠ¶æ€ |
|------|------|------|
| 2024-01-15 | æ•°æ®åº“è¿æ¥å¤±è´¥ | âœ… å·²è§£å†³ |

## å…³è”
- ç›¸å…³ Issue: #issue-def456
- ç›¸å…³ä»£ç : codemap.md#auth-module
```

### 2.2 findings.mdï¼ˆç ”ç©¶å‘ç°ï¼‰

```markdown
# Findings: ç ”ç©¶å‘ç°

## OAuth2.0 å®ç°æ–¹æ¡ˆ

**ID**: finding-001
**æ—¥æœŸ**: 2024-01-15
**å…³è”**: plan-abc123

### å‘ç°å†…å®¹
OAuth2.0 éœ€è¦ä½¿ç”¨ PKCEï¼ˆProof Key for Code Exchangeï¼‰æ¥ä¿è¯å®‰å…¨æ€§ï¼Œ
ç‰¹åˆ«æ˜¯åœ¨ç§»åŠ¨ç«¯å’Œ SPA åº”ç”¨ä¸­ã€‚

### å‚è€ƒé“¾æ¥
- [OAuth2.0 PKCE RFC](https://tools.ietf.org/html/rfc7636)
- [Auth0 PKCE Guide](https://auth0.com/docs/flows/call-your-api-using-the-authorization-code-flow-with-pkce)

---

## JWT Token è¿‡æœŸç­–ç•¥

**ID**: finding-002
**æ—¥æœŸ**: 2024-01-15
**å…³è”**: plan-abc123

### å‘ç°å†…å®¹
- Access Token: 15åˆ†é’Ÿè¿‡æœŸ
- Refresh Token: 7å¤©è¿‡æœŸ
- ä½¿ç”¨ Redis å­˜å‚¨é»‘åå•

### å†³ç­–
é‡‡ç”¨åŒ Token ç­–ç•¥ï¼ŒAccess Token çŸ­æœŸï¼ŒRefresh Token é•¿æœŸã€‚

---

## æ•°æ®åº“é€‰å‹

**ID**: finding-003
**æ—¥æœŸ**: 2024-01-16
**å…³è”**: plan-abc123

### å‘ç°å†…å®¹
å¯¹æ¯”äº† MySQL å’Œ PostgreSQLï¼š
- MySQL: æ›´ç†Ÿæ‚‰ï¼Œç¤¾åŒºå¤§
- PostgreSQL: JSON æ”¯æŒæ›´å¥½ï¼Œæ‰©å±•æ€§å¼º

### å†³ç­–
é€‰æ‹© PostgreSQLï¼Œå› ä¸ºéœ€è¦å­˜å‚¨ JSON æ ¼å¼çš„ç”¨æˆ·é…ç½®ã€‚
```

### 2.3 progress.mdï¼ˆè¿›åº¦æ—¥å¿—ï¼‰

```markdown
# Progress: è¿›åº¦æ—¥å¿—

## 2024-01-16

### 14:30 - å®Œæˆç™»å½•æ¥å£å®ç°
- **çŠ¶æ€**: âœ… æˆåŠŸ
- **è¯¦æƒ…**: å®ç°äº† /api/auth/login æ¥å£
- **å…³è”**: #issue-def456

### 16:00 - æ•°æ®åº“è¿ç§»å¤±è´¥
- **çŠ¶æ€**: âŒ å¤±è´¥
- **é”™è¯¯**: è¿æ¥è¶…æ—¶
- **è§£å†³**: å¢åŠ è¿æ¥æ± å¤§å°

---

## 2024-01-15

### 10:00 - å¼€å§‹è§„åˆ’
- **çŠ¶æ€**: âœ… æˆåŠŸ
- **è¯¦æƒ…**: åˆ›å»ºäº†è®¤è¯ç³»ç»Ÿè§„åˆ’

### 14:00 - å®Œæˆ OAuth è°ƒç ”
- **çŠ¶æ€**: âœ… æˆåŠŸ
- **è¯¦æƒ…**: ç¡®å®šä½¿ç”¨ PKCE æ–¹æ¡ˆ
- **äº§å‡º**: finding-001
```

### 2.4 issues.mdï¼ˆä»»åŠ¡/é—®é¢˜åˆ—è¡¨ï¼‰- æ–°å¢

```markdown
# Issues: ä»»åŠ¡ä¸é—®é¢˜

## ğŸ› Bugs

### #bug-001: ç™»å½•é¡µé¢å´©æºƒ
- **çŠ¶æ€**: ğŸ”´ Open
- **ä¼˜å…ˆçº§**: P0
- **åˆ›å»ºæ—¶é—´**: 2024-01-15
- **æè¿°**: ç”¨æˆ·ç™»å½•æ—¶é¡µé¢ç™½å±
- **å¤ç°æ­¥éª¤**:
  1. æ‰“å¼€ç™»å½•é¡µé¢
  2. è¾“å…¥ç”¨æˆ·åå¯†ç 
  3. ç‚¹å‡»ç™»å½•
- **å…³è”**: plan-abc123, codemap.md#login-page

---

## âœ¨ Features

### #feat-001: å®ç°ç™»å½•æ¥å£
- **çŠ¶æ€**: ğŸŸ¡ In Progress
- **ä¼˜å…ˆçº§**: P0
- **åˆ›å»ºæ—¶é—´**: 2024-01-15
- **è´Ÿè´£äºº**: @developer
- **æè¿°**: å®ç° POST /api/auth/login æ¥å£
- **éªŒæ”¶æ ‡å‡†**:
  - [ ] æ”¯æŒç”¨æˆ·åå¯†ç ç™»å½•
  - [ ] è¿”å› JWT Token
  - [ ] é”™è¯¯å¤„ç†å®Œå–„
- **ä¾èµ–**: #feat-002
- **å…³è”**: plan-abc123

### #feat-002: å®ç°å¯†ç åŠ å¯†
- **çŠ¶æ€**: ğŸŸ¢ Ready
- **ä¼˜å…ˆçº§**: P1
- **åˆ›å»ºæ—¶é—´**: 2024-01-15
- **æè¿°**: ä½¿ç”¨ bcrypt åŠ å¯†ç”¨æˆ·å¯†ç 
- **éªŒæ”¶æ ‡å‡†**:
  - [ ] å¯†ç åŠ å¯†å­˜å‚¨
  - [ ] å¯†ç éªŒè¯æ­£ç¡®

---

## ğŸ“‹ Tasks

### #task-001: ç¼–å†™å•å…ƒæµ‹è¯•
- **çŠ¶æ€**: â³ Blocked
- **ä¼˜å…ˆçº§**: P2
- **é˜»å¡åŸå› **: ç­‰å¾… #feat-001 å®Œæˆ
- **æè¿°**: ä¸ºç™»å½•æ¥å£ç¼–å†™å•å…ƒæµ‹è¯•

---

## ä¾èµ–å…³ç³»å›¾

```
plan-abc123 (è®¤è¯ç³»ç»Ÿ)
â”œâ”€â”€ #feat-001 (ç™»å½•æ¥å£) â† In Progress
â”‚   â””â”€â”€ #feat-002 (å¯†ç åŠ å¯†) â† Ready
â”‚       â””â”€â”€ #task-001 (å•å…ƒæµ‹è¯•) â† Blocked
â””â”€â”€ #bug-001 (ç™»å½•å´©æºƒ) â† Open
```

## å°±ç»ªä»»åŠ¡

ä»¥ä¸‹ä»»åŠ¡å¯ä»¥ç«‹å³å¼€å§‹ï¼š
- **#feat-002**: å®ç°å¯†ç åŠ å¯†ï¼ˆæ— é˜»å¡ï¼‰
```

### 2.5 codemap.mdï¼ˆä»£ç åœ°å›¾ï¼‰- æ–°å¢

```markdown
# Codemap: ä»£ç åœ°å›¾

## æ¦‚è§ˆ
- **æ€»å…¥å£æ•°**: 45
- **æœ€åæ‰«æ**: 2024-01-16 14:00
- **æ‰«æèŒƒå›´**: src/

---

## ğŸ“ Files

### src/auth/login.ts
- **ID**: cm-file-001
- **ç±»å‹**: æ–‡ä»¶å…¥å£
- **ç½®ä¿¡åº¦**: é«˜
- **æè¿°**: ç™»å½•é¡µé¢ç»„ä»¶
- **å…³è”**: #feat-001, #bug-001

---

## ğŸ”¤ Symbols

### authenticate()
- **ID**: cm-sym-001
- **ç±»å‹**: å‡½æ•°
- **ä½ç½®**: src/auth/service.ts:25
- **ç½®ä¿¡åº¦**: é«˜
- **æè¿°**: ç”¨æˆ·è®¤è¯æ ¸å¿ƒå‡½æ•°
- **æ ‡ç­¾**: auth, login, core
- **å…³è”**: #feat-001

### hashPassword()
- **ID**: cm-sym-002
- **ç±»å‹**: å‡½æ•°
- **ä½ç½®**: src/auth/crypto.ts:10
- **ç½®ä¿¡åº¦**: é«˜
- **æè¿°**: å¯†ç åŠ å¯†å‡½æ•°
- **æ ‡ç­¾**: auth, crypto, password
- **å…³è”**: #feat-002

---

## ğŸ›¤ï¸ Routes

### POST /api/auth/login
- **ID**: cm-route-001
- **ç±»å‹**: API è·¯ç”±
- **ä½ç½®**: src/routes/auth.ts:15
- **ç½®ä¿¡åº¦**: é«˜
- **æè¿°**: ç™»å½•æ¥å£
- **å…³è”**: #feat-001

### POST /api/auth/register
- **ID**: cm-route-002
- **ç±»å‹**: API è·¯ç”±
- **ä½ç½®**: src/routes/auth.ts:35
- **ç½®ä¿¡åº¦**: é«˜
- **æè¿°**: æ³¨å†Œæ¥å£
- **å…³è”**: plan-abc123

---

## ğŸ—„ï¸ Database

### users è¡¨
- **ID**: cm-table-001
- **ç±»å‹**: æ•°æ®è¡¨
- **ä½ç½®**: migrations/001_create_users.sql
- **ç½®ä¿¡åº¦**: é«˜
- **å­—æ®µ**: id, username, password_hash, created_at
- **å…³è”**: plan-abc123

---

## ç´¢å¼•

### æŒ‰æ ‡ç­¾
- auth: cm-sym-001, cm-sym-002, cm-route-001, cm-route-002
- login: cm-file-001, cm-sym-001, cm-route-001
- password: cm-sym-002

### æŒ‰ Issue
- #feat-001: cm-file-001, cm-sym-001, cm-route-001
- #feat-002: cm-sym-002
- #bug-001: cm-file-001
```

### 2.6 knowledge.mdï¼ˆæ ¸å¿ƒä»£ç é€»è¾‘ï¼‰- æ–°å¢

```markdown
# Knowledge: æ ¸å¿ƒä»£ç é€»è¾‘çŸ¥è¯†åº“

> è®°å½•æ ¸å¿ƒä»£ç çš„é€»è¾‘æ€»ç»“ã€ç‰ˆæœ¬è¿­ä»£å†å²ï¼Œä¾› AI Agent å¿«é€Ÿç†è§£æ ¸å¿ƒé€»è¾‘ã€‚

---

## è®¤è¯æ¨¡å—

### authenticate() å‡½æ•°
- **æ–‡ä»¶**: src/auth/service.ts:25
- **å½“å‰ç‰ˆæœ¬**: v2.1ï¼ˆ2024-01-16ï¼‰
- **å…³è”**: #feat-001, cm-sym-001

#### æ ¸å¿ƒé€»è¾‘
1. æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·
2. éªŒè¯å¯†ç å“ˆå¸Œ
3. ç”Ÿæˆ JWT Token
4. è®°å½•ç™»å½•æ—¥å¿—

#### ä»£ç ç‰‡æ®µ
```typescript
async function authenticate(username: string, password: string): Promise<string> {
  const user = await User.findByUsername(username);
  if (!user) throw new AuthError('ç”¨æˆ·ä¸å­˜åœ¨');
  
  const valid = await bcrypt.compare(password, user.passwordHash);
  if (!valid) throw new AuthError('å¯†ç é”™è¯¯');
  
  await LoginLog.create({ userId: user.id, time: new Date() });
  return jwt.sign({ userId: user.id }, SECRET, { expiresIn: '15m' });
}
```

#### ç‰ˆæœ¬å†å²
| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´è¯´æ˜ | ä½œè€… |
|------|------|---------|------|
| v2.1 | 2024-01-16 | å¢åŠ ç™»å½•æ—¥å¿—è®°å½• | @dev |
| v2.0 | 2024-01-10 | é‡æ„ä¸º async/await | @dev |
| v1.0 | 2024-01-05 | åˆå§‹å®ç° | @dev |

---

## æ•°æ®åº“è¿æ¥æ± 

### getConnection() å‡½æ•°
- **æ–‡ä»¶**: src/db/pool.ts:10
- **å½“å‰ç‰ˆæœ¬**: v1.2ï¼ˆ2024-01-14ï¼‰
- **å…³è”**: cm-sym-003

#### æ ¸å¿ƒé€»è¾‘
1. æ£€æŸ¥è¿æ¥æ± çŠ¶æ€
2. è·å–å¯ç”¨è¿æ¥
3. è‡ªåŠ¨é‡è¿æœºåˆ¶ï¼ˆæœ€å¤š3æ¬¡ï¼‰

#### ä»£ç ç‰‡æ®µ
```typescript
async function getConnection(): Promise<Connection> {
  for (let i = 0; i < 3; i++) {
    try {
      return await pool.getConnection();
    } catch (e) {
      if (i === 2) throw e;
      await reconnect();
    }
  }
}
```

#### ç‰ˆæœ¬å†å²
| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´è¯´æ˜ |
|------|------|---------|
| v1.2 | 2024-01-14 | å¢åŠ è‡ªåŠ¨é‡è¿æœºåˆ¶ |
| v1.1 | 2024-01-08 | ä¼˜åŒ–è¿æ¥æ± å¤§å° |
| v1.0 | 2024-01-03 | åˆå§‹å®ç° |

---

## ç´¢å¼•

### æŒ‰æ¨¡å—
- è®¤è¯: authenticate(), hashPassword(), verifyToken()
- æ•°æ®åº“: getConnection(), withTransaction()
- ç¼“å­˜: getCache(), setCache()

### æŒ‰æ–‡ä»¶
- src/auth/service.ts: authenticate(), verifyToken()
- src/auth/crypto.ts: hashPassword(), verifyPassword()
- src/db/pool.ts: getConnection(), withTransaction()
```

### 2.7 decisions.mdï¼ˆæŠ€æœ¯å†³ç­–è®°å½•ï¼‰- æ–°å¢

```markdown
# Decisions: æŠ€æœ¯å†³ç­–è®°å½•ï¼ˆADRï¼‰

> è®°å½•æŠ€æœ¯é€‰å‹çš„èƒŒæ™¯ã€ç†ç”±ã€åæœï¼Œä¾›åç»­å¼€å‘è€…ç†è§£è®¾è®¡å†³ç­–ã€‚

---

## ADR-001: ä½¿ç”¨ JWT è¿›è¡Œè®¤è¯

**çŠ¶æ€**: âœ… å·²é‡‡çº³
**æ—¥æœŸ**: 2024-01-05
**å†³ç­–è€…**: @developer

### èƒŒæ™¯
éœ€è¦å®ç°ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼Œè€ƒè™‘äº† Session å’Œ JWT ä¸¤ç§æ–¹æ¡ˆã€‚

### å†³ç­–
é‡‡ç”¨ JWTï¼ˆJSON Web Tokenï¼‰æ–¹æ¡ˆã€‚

### ç†ç”±
1. **æ— çŠ¶æ€**ï¼šæœåŠ¡ç«¯ä¸éœ€è¦å­˜å‚¨ä¼šè¯ï¼Œæ˜“äºæ°´å¹³æ‰©å±•
2. **è·¨æœåŠ¡å…±äº«**ï¼šå¤šä¸ªå¾®æœåŠ¡å¯ä»¥å…±äº«åŒä¸€ä¸ª Token
3. **ç§»åŠ¨ç«¯å‹å¥½**ï¼šåŸç”Ÿ App å’Œ SPA éƒ½å¯ä»¥æ–¹ä¾¿ä½¿ç”¨

### åæœ
- **æ­£é¢**ï¼šç®€åŒ–äº†æœåŠ¡ç«¯æ¶æ„ï¼Œæé«˜äº†æ‰©å±•æ€§
- **è´Ÿé¢**ï¼šéœ€è¦å¤„ç† Token è¿‡æœŸå’Œåˆ·æ–°æœºåˆ¶ï¼ŒToken æ— æ³•ä¸»åŠ¨æ’¤é”€

### ç›¸å…³ä»£ç 
- src/auth/jwt.ts
- src/middleware/auth.ts
- knowledge.md#authenticate

### æ›¿ä»£æ–¹æ¡ˆ
- Session + Cookieï¼šéœ€è¦æœåŠ¡ç«¯å­˜å‚¨ï¼Œæ‰©å±•æ€§å·®
- OAuth2.0 å®Œæ•´æµç¨‹ï¼šè¿‡äºå¤æ‚ï¼Œä¸é€‚åˆå½“å‰åœºæ™¯

---

## ADR-002: ä½¿ç”¨ PostgreSQL å­˜å‚¨ JSON

**çŠ¶æ€**: âœ… å·²é‡‡çº³
**æ—¥æœŸ**: 2024-01-06

### èƒŒæ™¯
éœ€è¦å­˜å‚¨ç”¨æˆ·é…ç½®ï¼Œæ ¼å¼ä¸º JSONï¼Œä¸”éœ€è¦æ”¯æŒæŸ¥è¯¢ã€‚

### å†³ç­–
ä½¿ç”¨ PostgreSQL çš„ JSONB ç±»å‹å­˜å‚¨ JSON æ•°æ®ã€‚

### ç†ç”±
1. **åŸç”Ÿæ”¯æŒ**ï¼šPostgreSQL å¯¹ JSON æœ‰å®Œå–„çš„æ”¯æŒ
2. **ç´¢å¼•èƒ½åŠ›**ï¼šå¯ä»¥å¯¹ JSON å­—æ®µå»ºç«‹ç´¢å¼•
3. **æŸ¥è¯¢èƒ½åŠ›**ï¼šæ”¯æŒå¤æ‚çš„ JSON æŸ¥è¯¢æ“ä½œ

### åæœ
- **æ­£é¢**ï¼šçµæ´»å­˜å‚¨ï¼ŒæŸ¥è¯¢æ€§èƒ½å¥½
- **è´Ÿé¢**ï¼šå›¢é˜Ÿéœ€è¦å­¦ä¹  PostgreSQL çš„ JSON è¯­æ³•

### ç›¸å…³ä»£ç 
- migrations/002_add_user_config.sql
- src/models/user.ts

---

## ADR-003: ä½¿ç”¨ Redis åšç¼“å­˜

**çŠ¶æ€**: âœ… å·²é‡‡çº³
**æ—¥æœŸ**: 2024-01-08

### èƒŒæ™¯
éœ€è¦ç¼“å­˜çƒ­ç‚¹æ•°æ®ï¼Œå‡å°‘æ•°æ®åº“å‹åŠ›ã€‚

### å†³ç­–
ä½¿ç”¨ Redis ä½œä¸ºç¼“å­˜å±‚ã€‚

### ç†ç”±
1. **é«˜æ€§èƒ½**ï¼šå†…å­˜å­˜å‚¨ï¼Œè¯»å†™æå¿«
2. **ä¸°å¯Œæ•°æ®ç»“æ„**ï¼šæ”¯æŒ Stringã€Hashã€Set ç­‰
3. **è¿‡æœŸæœºåˆ¶**ï¼šå¤©ç„¶æ”¯æŒ TTL

### åæœ
- **æ­£é¢**ï¼šæ˜¾è‘—æå‡å“åº”é€Ÿåº¦
- **è´Ÿé¢**ï¼šå¢åŠ äº†è¿ç»´å¤æ‚åº¦ï¼Œéœ€è¦å¤„ç†ç¼“å­˜ä¸€è‡´æ€§

---

## ç´¢å¼•

### æŒ‰çŠ¶æ€
- å·²é‡‡çº³: ADR-001, ADR-002, ADR-003
- å·²åºŸå¼ƒ: ï¼ˆæš‚æ— ï¼‰
- å¾…è®¨è®º: ï¼ˆæš‚æ— ï¼‰

### æŒ‰æ¨¡å—
- è®¤è¯: ADR-001
- æ•°æ®åº“: ADR-002
- ç¼“å­˜: ADR-003
```

---

## ä¸‰ã€å‘½ä»¤è®¾è®¡

### 3.1 å‘½ä»¤æ¦‚è§ˆ

```bash
# è§„åˆ’å‘½ä»¤
plan init <task>           # åˆå§‹åŒ–è§„åˆ’
plan status                # æŸ¥çœ‹çŠ¶æ€
plan next                  # è·å–ä¸‹ä¸€æ­¥
plan phase <phase>         # æ›´æ–°é˜¶æ®µ
plan checkpoint <name>     # åˆ›å»ºæ£€æŸ¥ç‚¹
plan complete              # å®Œæˆè§„åˆ’

# ç ”ç©¶å‘ç°å‘½ä»¤
finding create <finding>   # åˆ›å»ºå‘ç°
finding list               # åˆ—å‡ºå‘ç°
finding link <plan-id>     # å…³è”åˆ°è§„åˆ’

# è¿›åº¦å‘½ä»¤
progress log <message>     # è®°å½•è¿›åº¦
progress show              # æ˜¾ç¤ºå†å²
progress error <error>     # è®°å½•é”™è¯¯

# Issue å‘½ä»¤ï¼ˆæ–°å¢ï¼‰
issue create <title>       # åˆ›å»º Issue
issue list                 # åˆ—å‡º Issue
issue show <id>            # æ˜¾ç¤ºè¯¦æƒ…
issue close <id>           # å…³é—­ Issue
issue dep <child> <parent> # æ·»åŠ ä¾èµ–
issue ready                # æŸ¥çœ‹å°±ç»ªä»»åŠ¡

# Codemap å‘½ä»¤ï¼ˆæ–°å¢ï¼‰
codemap scan               # æ‰«æä»£ç 
codemap query <keyword>    # æŸ¥è¯¢å…¥å£
codemap link <issue-id>    # å…³è” Issue
codemap export             # å¯¼å‡ºæ–‡æ¡£

# Knowledge å‘½ä»¤ï¼ˆæ–°å¢ï¼‰
knowledge add <name>       # æ·»åŠ æ ¸å¿ƒä»£ç é€»è¾‘
knowledge show <name>      # æ˜¾ç¤ºé€»è¾‘è¯¦æƒ…
knowledge history <name>   # æŸ¥çœ‹ç‰ˆæœ¬å†å²
knowledge update <name>    # æ›´æ–°ç‰ˆæœ¬

# Decision å‘½ä»¤ï¼ˆæ–°å¢ï¼‰
decision create <title>    # åˆ›å»ºæŠ€æœ¯å†³ç­–
decision list              # åˆ—å‡ºå†³ç­–
decision show <id>         # æ˜¾ç¤ºå†³ç­–è¯¦æƒ…
decision supersede <id>    # åºŸå¼ƒå†³ç­–

# å…¨å±€å‘½ä»¤
search <keyword>           # å…¨å±€æœç´¢
sync                       # åŒæ­¥åˆ°è¿œç¨‹
```

### 3.2 å‘½ä»¤ç¤ºä¾‹

```bash
# 1. åˆå§‹åŒ–è§„åˆ’
plan init "å®ç°ç”¨æˆ·è®¤è¯ç³»ç»Ÿ"

# 2. è®°å½•ç ”ç©¶å‘ç°
finding create "OAuth2.0 éœ€è¦ä½¿ç”¨ PKCE"

# 3. åˆ›å»º Issue
issue create "å®ç°ç™»å½•æ¥å£" --type feature --priority 0

# 4. å»ºç«‹ä¾èµ–
issue dep #feat-001 #feat-002

# 5. æ‰«æä»£ç 
codemap scan

# 6. å…³è”ä»£ç 
codemap link #feat-001 --query "login"

# 7. è®°å½•è¿›åº¦
progress log "å®Œæˆç™»å½•æ¥å£å®ç°" --success

# 8. æŸ¥çœ‹å°±ç»ªä»»åŠ¡
issue ready

# 9. å®Œæˆè§„åˆ’
plan complete
```

---

## å››ã€ç´¢å¼•æ ¼å¼ï¼ˆå¯é€‰ï¼‰

### 4.1 .planning/index.jsonl

```
{"type":"plan","id":"plan-abc123","title":"å®ç°ç”¨æˆ·è®¤è¯ç³»ç»Ÿ","status":"in_progress","phase":"implementation","file":"plan.md"}
{"type":"finding","id":"finding-001","title":"OAuth2.0 å®ç°æ–¹æ¡ˆ","plan":"plan-abc123","file":"findings.md"}
{"type":"issue","id":"feat-001","title":"å®ç°ç™»å½•æ¥å£","type":"feature","status":"in_progress","priority":0,"file":"issues.md"}
{"type":"codemap","id":"cm-sym-001","name":"authenticate","kind":"symbol","file":"codemap.md"}
{"type":"progress","id":"prog-001","message":"å®Œæˆç™»å½•æ¥å£","success":true,"file":"progress.md"}
```

### 4.2 ç´¢å¼•ç”¨é€”

- **AI Agent å¿«é€ŸæŸ¥è¯¢**ï¼šæ— éœ€è§£æ MDï¼Œç›´æ¥è¯»å– JSONL
- **å…¨æ–‡æœç´¢**ï¼šå»ºç«‹å€’æ’ç´¢å¼•
- **å…³è”æŸ¥è¯¢**ï¼šå¿«é€ŸæŸ¥æ‰¾å…³è”å…³ç³»

---

## äº”ã€ä¸åŸ Planning with Files çš„å…¼å®¹æ€§

### 5.1 å‘åå…¼å®¹

| åŸæ–‡ä»¶ | æ–°æ–‡ä»¶ | å…¼å®¹æ€§ |
|--------|--------|--------|
| task_plan.md | plan.md | âœ… æ ¼å¼å…¼å®¹ |
| findings.md | findings.md | âœ… æ ¼å¼å…¼å®¹ |
| progress.md | progress.md | âœ… æ ¼å¼å…¼å®¹ |
| - | issues.md | ğŸ†• æ–°å¢ |
| - | codemap.md | ğŸ†• æ–°å¢ |

### 5.2 è¿ç§»è·¯å¾„

```bash
# ä»åŸ Planning with Files è¿ç§»
planning migrate

# è‡ªåŠ¨è½¬æ¢ï¼š
# task_plan.md â†’ plan.md
# findings.md â†’ findings.mdï¼ˆä¿æŒä¸å˜ï¼‰
# progress.md â†’ progress.mdï¼ˆä¿æŒä¸å˜ï¼‰
```

---

## å…­ã€å®ç°ä¼˜å…ˆçº§

### Phase 1ï¼šæ ¸å¿ƒåŠŸèƒ½ï¼ˆ1 å‘¨ï¼‰
- [ ] plan.md æ ¼å¼å®šä¹‰
- [ ] plan å‘½ä»¤å®ç°
- [ ] finding å‘½ä»¤å®ç°
- [ ] progress å‘½ä»¤å®ç°

### Phase 2ï¼šIssue ç®¡ç†ï¼ˆ1 å‘¨ï¼‰
- [ ] issues.md æ ¼å¼å®šä¹‰
- [ ] issue å‘½ä»¤å®ç°
- [ ] ä¾èµ–å…³ç³»ç®¡ç†
- [ ] ready å‘½ä»¤å®ç°

### Phase 3ï¼šCodemapï¼ˆ1 å‘¨ï¼‰
- [ ] codemap.md æ ¼å¼å®šä¹‰
- [ ] codemap scan å®ç°
- [ ] codemap query å®ç°
- [ ] codemap link å®ç°

### Phase 4ï¼šç´¢å¼•ä¸æœç´¢ï¼ˆ1 å‘¨ï¼‰
- [ ] index.jsonl ç”Ÿæˆ
- [ ] search å‘½ä»¤å®ç°
- [ ] AI Agent é›†æˆ

---

## ä¸ƒã€æ€»ç»“

### æ ¸å¿ƒè®¾è®¡å†³ç­–

| å†³ç­– | é€‰æ‹© | ç†ç”± |
|------|------|------|
| **ä¸»æ ¼å¼** | MD | äººç±»å‹å¥½ï¼Œä¿æŒåŸé¡¹ç›®ç†å¿µ |
| **ç´¢å¼•æ ¼å¼** | JSONLï¼ˆå¯é€‰ï¼‰ | AI å‹å¥½ï¼Œå¿«é€ŸæŸ¥è¯¢ |
| **æ–‡ä»¶æ•°é‡** | 5 ä¸ª | plan + findings + progress + issues + codemap |
| **å‘½ä»¤å‰ç¼€** | æ— å‰ç¼€ | ç®€æ´ï¼Œä¸åŸé¡¹ç›®ä¸€è‡´ |

### ä¸ Beads çš„åŒºåˆ«

| ç»´åº¦ | Beads | Planning with Files Enhanced |
|------|-------|------------------------------|
| **ä¸»æ ¼å¼** | JSONL | MD |
| **å­˜å‚¨ä½ç½®** | .beads/ | é¡¹ç›®æ ¹ç›®å½• |
| **äººç±»å¯è¯»** | â­â­ | â­â­â­â­â­ |
| **AI å¯å¤„ç†** | â­â­â­â­â­ | â­â­â­â­ |
| **ç¼–è¾‘æ–¹å¼** | å‘½ä»¤è¡Œ | å‘½ä»¤è¡Œ + ç›´æ¥ç¼–è¾‘ MD |

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv2.0
**åˆ›å»ºæ—¥æœŸ**ï¼š2024-01-17
